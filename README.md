

Документация для Telegram Бота


Обзор
Этот Telegram бот взаимодействует с пользователями для поиска фильмов с использованием API Kinopoisk и ведет историю запросов пользователей. Бот предоставляет команды для начала работы, поиска фильмов, получения фильмов по рейтингу или бюджету и просмотра истории запросов.


Зависимости
    requests: Для выполнения HTTP-запросов к API Kinopoisk.
    telebot: Для взаимодействия с Telegram Bot API.
    config: Содержит конфигурацию, такую как токен бота, команды по умолчанию и заголовки API.
    models: Содержит модели ORM Peewee (User, History, db) для взаимодействия с базой данных.
Настройка
    Установка зависимостей
    Убедитесь, что у вас установлены необходимые пакеты. Вы можете установить их с помощью pip:
    pip install requests pyTelegramBotAPI peewee
    или установите requests.txt:
    ip install -r requirements.txt


Конфигурация
Убедитесь, что файл config.py содержит ваш токен бота, команды по умолчанию и заголовки для запросов к API. Пример:
BOT_TOKEN = 'ВАШ_ТОКЕН_БОТА'
DEFAULT_COMMANDS = [
    ('start', 'Запуск бота'),
    ('help', 'Получить помощь'),
    ('movie_search', 'Поиск фильма'),
    ('movie_by_rating', 'Фильмы по рейтингу'),
    ('low_budget_movie', 'Фильмы с низким бюджетом'),
    ('high_budget_movie', 'Фильмы с высоким бюджетом'),
    ('history', 'Посмотреть историю запросов')
]
HEADERS = {
    'Authorization': 'ВАШ_API_КЛЮЧ',
    'Content-Type': 'application/json'
}


Модели базы данных
Убедитесь, что файл models.py содержит определения моделей базы данных с использованием ORM Peewee.


Команды
/start
Описание: Инициализирует бота и регистрирует нового пользователя или приветствует существующего.
Использование: /start
Ответ: Отправляет приветственное сообщение пользователю.


/help
Описание: Предоставляет список доступных команд и их описания.
Использование: /help
Ответ: Отправляет сообщение со списком команд и их описанием.


/movie_search
Описание: Запрашивает у пользователя название фильма для поиска.
Использование: /movie_search
Ответ: Запрашивает название фильма и отображает результаты поиска.


/movie_by_rating
Описание: Ищет фильмы на основе рейтинга IMDb.
Использование: /movie_by_rating
Ответ: Запрашивает у пользователя рейтинг и отображает результаты поиска.


/low_budget_movie
Описание: Находит и отображает фильмы с низким бюджетом.
Использование: /low_budget_movie
Ответ: Показывает список фильмов с низким бюджетом.


/high_budget_movie
Описание: Находит и отображает фильмы с высоким бюджетом.
Использование: /high_budget_movie
Ответ: Показывает список фильмов с высоким бюджетом.


/history
Описание: Отображает историю запросов пользователя.
Использование: /history
Ответ: Показывает список фильмов, которые пользователь искал ранее.


Функции
search_movie(message: Message)
Описание: Обрабатывает поиск фильмов на основе ввода пользователя.
Использование: Вызывается после того, как пользователь предоставляет название фильма.
Параметры: message - Объект сообщения Telegram, содержащий ввод пользователя.
Ответ: Ищет фильм и создает запись в истории.


search_movie_by_rating(message: Message)
Описание: Обрабатывает поиск фильмов на основе указанного пользователем рейтинга IMDb.
Использование: Вызывается после того, как пользователь предоставляет рейтинг.
Параметры: message - Объект сообщения Telegram, содержащий ввод пользователя.
Ответ: Ищет фильмы с указанным рейтингом.


movie_info(message: Message, movie)
Описание: Форматирует и отправляет информацию о фильме пользователю.
Использование: Вызывается для отображения деталей фильма после поиска.
Параметры:
message - Объект сообщения Telegram.
movie - Данные о фильме, полученные от API.
Ответ: Отправляет сообщение с деталями фильма.


truncate_description(description, word_limit)
Описание: Обрезает описание фильма до указанного лимита слов.
Использование: Используется для сокращения описаний перед отображением.
Параметры:
description - Полное описание фильма.
word_limit - Максимальное количество слов для отображения.
Ответ: Возвращает обрезанное описание.


Запуск бота
Чтобы запустить бота, убедитесь, что файлы config.py и models.py настроены правильно, и выполните скрипт бота:
python main.py
где main.py — это имя вашего скрипта с кодом бота.