Документация для Telegram Бота


Обзор
Этот Telegram бот взаимодействует с пользователями для поиска фильмов с использованием API Kinopoisk и ведет историю запросов пользователей. Бот предоставляет команды для начала работы, поиска фильмов, получения фильмов по рейтингу или бюджету и просмотра истории запросов.


Зависимости
    requests: Для выполнения HTTP-запросов к API Kinopoisk.
    telebot: Для взаимодействия с Telegram Bot API.
    config: Содержит конфигурацию, такую как токен бота, команды по умолчанию и заголовки API.
    models: Содержит модели ORM Peewee (User, History, db) для взаимодействия с базой данных.
Настройка
    Установка зависимостей
    Убедитесь, что у вас установлены необходимые пакеты. Вы можете установить их с помощью pip:
    pip install requests pyTelegramBotAPI peewee
    или установите requests.txt:
    ip install -r requirements.txt


Конфигурация
Убедитесь, что файл config.py содержит ваш токен бота, команды по умолчанию и заголовки для запросов к API. Пример:
BOT_TOKEN = 'ВАШ_ТОКЕН_БОТА'
DEFAULT_COMMANDS = [
    ('start', 'Запуск бота'),
    ('help', 'Получить помощь'),
    ('movie_search', 'Поиск фильма'),
    ('movie_by_rating', 'Фильмы по рейтингу'),
    ('low_budget_movie', 'Фильмы с низким бюджетом'),
    ('high_budget_movie', 'Фильмы с высоким бюджетом'),
    ('history', 'Посмотреть историю запросов')
]
HEADERS = {
    'Authorization': 'ВАШ_API_КЛЮЧ',
    'Content-Type': 'application/json'
}


Модели базы данных
Убедитесь, что файл models.py содержит определения моделей базы данных с использованием ORM Peewee.


Команды
/start
Описание: Инициализирует бота и регистрирует нового пользователя или приветствует существующего.
Использование: /start
Ответ: Отправляет приветственное сообщение пользователю.


/help
Описание: Предоставляет список доступных команд и их описания.
Использование: /help
Ответ: Отправляет сообщение со списком команд и их описанием.


/movie_search - "https://api.kinopoisk.dev/v1.4/movie/search?limit=1&query={movie_name_url}"
Описание: Запрашивает у пользователя название фильма для поиска.
Использование: /movie_search
Ответ: Запрашивает название фильма и отображает результаты поиска.


/movie_by_rating - "https://api.kinopoisk.dev/v1.4/movie/search?limit=5&rating.imdb={rating}-10"
Описание: Ищет фильмы на основе рейтинга IMDb.
Использование: /movie_by_rating
Ответ: Запрашивает у пользователя рейтинг и отображает результаты поиска.


/low_budget_movie - "https://api.kinopoisk.dev/v1.4/movie?limit=5&selectFields=&notNullFields=budget.value&notNullFields=name&notNullFields=description&sortField=budget.value&sortType=-1"
Описание: Находит и отображает фильмы с низким бюджетом.
Использование: /low_budget_movie
Ответ: Показывает список фильмов с низким бюджетом.


/high_budget_movie - "https://api.kinopoisk.dev/v1.4/movie?limit=5&selectFields=&notNullFields=budget.value&notNullFields=name&notNullFields=description&sortField=budget.value&sortType=1"
Описание: Находит и отображает фильмы с высоким бюджетом.
Использование: /high_budget_movie
Ответ: Показывает список фильмов с высоким бюджетом.


/history
Описание: Отображает историю запросов пользователя.
Использование: /history
Ответ: Показывает список фильмов, которые пользователь искал ранее.


Функции
search_movie(message: Message)
Описание: Обрабатывает поиск фильмов на основе ввода пользователя.
Использование: Вызывается после того, как пользователь предоставляет название фильма.
Параметры: message - Объект сообщения Telegram, содержащий ввод пользователя.
Ответ: Ищет фильм и создает запись в истории.


search_movie_by_rating(message: Message)
Описание: Обрабатывает поиск фильмов на основе указанного пользователем рейтинга IMDb.
Использование: Вызывается после того, как пользователь предоставляет рейтинг.
Параметры: message - Объект сообщения Telegram, содержащий ввод пользователя.
Ответ: Ищет фильмы с указанным рейтингом.


movie_info(message: Message, movie)
Описание: Форматирует и отправляет информацию о фильме пользователю.
Использование: Вызывается для отображения деталей фильма после поиска.
Параметры:
message - Объект сообщения Telegram.
movie - Данные о фильме, полученные от API.
Ответ: Отправляет сообщение с деталями фильма.


truncate_description(description, word_limit)
Описание: Обрезает описание фильма до указанного лимита слов.
Использование: Используется для сокращения описаний перед отображением.
Параметры:
description - Полное описание фильма.
word_limit - Максимальное количество слов для отображения.
Ответ: Возвращает обрезанное описание.


Запуск бота
Чтобы запустить бота, убедитесь, что файлы config.py и models.py настроены правильно, и выполните скрипт бота:
python main.py
где main.py — это имя вашего скрипта с кодом бота.



### Описание проекта
Цель: Создание Telegram-бота, который позволяет пользователям находить информацию о фильмах и сериалах с использованием API Kinopoisk, а также вести историю их поисковых запросов.

### Как пользоваться
Описываем какие команды и какая логика заложена в вашем проекте.
В ТЗ говориться что должны быть базовые команды, их можно изменить по своему усмотрению
Главное показать какие endpoint API используются для каждой команды в вашем боте,
с какими параметрами и результатом ответа

#### custom command:


**/movie_search**
Описание: Запрашивает у пользователя название фильма для поиска.
Логика: Запрашивает название фильма, выполняет запрос к API Kinopoisk, обрабатывает результаты и отправляет их пользователю.
Пример использования: /movie_search (далее пользователь вводит название фильма)
API Endpoint: https://api.kinopoisk.dev/v1.4/movie/search?limit=1&query={movie_name}
Параметры: {movie_name} - название фильма.
Результат: Отправка пользователю информации о найденном фильме.

**/movie_by_rating**
Описание: Ищет фильмы на основе рейтинга IMDb.
Логика: Запрашивает у пользователя рейтинг, выполняет запрос к API Kinopoisk, обрабатывает результаты и отправляет их пользователю.
Пример использования: /movie_by_rating (далее пользователь вводит рейтинг)
API Endpoint: https://api.kinopoisk.dev/v1.4/movie/search?limit=5&rating.imdb={rating}-10
Параметры: {rating} - рейтинг фильма на IMDb.
Результат: Отправка пользователю списка фильмов с указанным рейтингом.

**/low_budget_movie**
Описание: Находит и отображает фильмы с низким бюджетом.
Логика: Выполняет запрос к API Kinopoisk для получения фильмов с низким бюджетом, обрабатывает результаты и отправляет их пользователю.
Пример использования: /low_budget_movie
API Endpoint: https://api.kinopoisk.dev/v1.4/movie?limit=5&selectFields=&notNullFields=budget.value&notNullFields=name&notNullFields=description&sortField=budget.value&sortType=-1
Параметры: None.
Результат: Отправка пользователю списка фильмов с низким бюджетом.

**/high_budget_movie**
Описание: Находит и отображает фильмы с высоким бюджетом.
Логика: Выполняет запрос к API Kinopoisk для получения фильмов с высоким бюджетом, обрабатывает результаты и отправляет их пользователю.
Пример использования: /high_budget_movie
API Endpoint: https://api.kinopoisk.dev/v1.4/movie?limit=5&selectFields=&notNullFields=budget.value&notNullFields=name&notNullFields=description&sortField=budget.value&sortType=1
Параметры: None.
Результат: Отправка пользователю списка фильмов с высоким бюджетом.

**/history**
Описание: Отображает историю запросов пользователя.
Логика: Извлекает историю поисковых запросов пользователя из базы данных и отправляет ее пользователю.
Пример использования: /history
Результат: Отправка пользователю списка фильмов, которые он искал ранее.


#### default command:

**/start**
Описание: Инициализирует бота и регистрирует нового пользователя или приветствует существующего.
Логика: Принимает сообщение от пользователя и отправляет приветственное сообщение.
Пример использования: /start
Результат: Отправка приветственного сообщения с информацией о боте.

**/help**
Описание: Предоставляет список доступных команд и их описания.
Логика: Принимает команду и отправляет сообщение с описанием всех доступных команд.
Пример использования: /help
Результат: Отправка сообщения со списком команд и их описанием.

### Как запустить
Следуйте инструкциям ниже, чтобы установить и запустить Telegram-бота на стороннем ПК.

#### Шаг 1: Клонирование репозитория
Сначала клонируйте репозиторий проекта с GitHub:
git clone https://github.com/AnisAP17/BotSkillbox.git
cd bot_structure

#### Шаг 2: Создание и активация виртуального окружения
Создайте виртуальное окружение для изоляции зависимостей проекта:

python -m venv venv

##### Активируйте виртуальное окружение:

Для Windows:
venv\Scripts\activate

Для macOS и Linux:
source venv/bin/activate


#### Шаг 3: Установка зависимостей

Установите все необходимые библиотеки и пакеты:

pip install -r requirements.txt


#### Шаг 4: Настройка конфигурации

Создайте файл .env в корневом каталоге проекта и добавьте в него следующие переменные окружения:

BOT_TOKEN=ваш_токен_бота
X_API_KEY=ваш_api_ключ

Пример содержимого файла .env:
BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrSTUvwxYZ
X_API_KEY=PSKZE45-G1K4J14-NSMPN93-K0JQVT0

Убедитесь, что файл config.py настроен правильно и содержит ваш токен бота и заголовки API. Пример:

import os
from dotenv import load_dotenv

# Загрузка переменных окружения из файла .env
load_dotenv()

BOT_TOKEN = os.getenv("BOT_TOKEN")

DEFAULT_COMMANDS = (
    ('start', 'Регистрация или приветствие'),
    ('help', 'Показать все доступные команды'),
    ('movie_search', 'поиск фильма/сериала по названию'),
    ('movie_by_rating', 'поиск фильмов/сериалов по рейтингу'),
    ('low_budget_movie', 'поиск фильмов/сериалов с низким бюджетом'),
    ('high_budget_movie', 'поиск фильмов/сериалов с высоким бюджетом'),
    ('history', 'возможность просмотра истории поиска фильма/сериала'),
)

HEADERS = {
    "accept": "application/json",
    "X-API-KEY": os.getenv("X_API_KEY")
}


#### Шаг 5: Настройка базы данных

Убедитесь, что файл models.py содержит определения моделей базы данных с использованием ORM Peewee. Пример:


import os
from peewee import Model, SqliteDatabase, CharField, TextField, ForeignKeyField

# Определение пути к базе данных
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
db_path = os.path.join(BASE_DIR, '..', 'database.db')

# Инициализация базы данных
db = SqliteDatabase(db_path)

class User(Model):
    username = CharField(unique=True)
    chat_id = CharField(unique=True)

    class Meta:
        database = db

class History(Model):
    user = ForeignKeyField(User, backref='history')
    query = TextField()

    class Meta:
        database = db

# Создание таблиц
db.connect()
db.create_tables([User, History])


#### Шаг 6: Запуск бота
После настройки всех конфигураций, запустите скрипт бота:

python main.py


Теперь ваш Telegram-бот должен быть запущен и готов к взаимодействию с пользователями.